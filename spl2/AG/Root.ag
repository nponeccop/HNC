-- Root - корневой узел.
-- Необходим для задания атрибутов по умолчанию для корневого узла Definition

-- Узел Root - единственный узел, к атрибутам которого нужен доступ "снаружи".
-- Поэтому генерируется "обертка" вокруг кортежей атрибутов -
-- структуры Syn_Root, Inh_Root и функция wrap_Root, позволяющие
-- работать с атрибутами как с именованными полями.

WRAPPER Root

-- Единственным дочерним узлом Root является корневое определение. Поэтому
-- программа на HN0, по-крайней мере, пока, представляет собой одну корневую
-- функцию. В будущем дочерним узлом у корневого будет Program, что более
-- соответствует общепринятому представлению о программах как о последовательностях
-- корневых определений.
--
-- Несмотря на то, что UUAG может сам генерировать объявления АТД для узлов, эта
-- возможность не используется. Поэтому каждый узел нашего дерева абстрактного синтаксиса
-- (AST) описан дважды - один раз для Хаскеля (для парсера) в HN.Intermediate, второй
-- раз - для UUAG здесь.
--
-- В перспективе, возможно, прийдется отказаться от парсека и парсить исходники
-- с помощью парсера UU, если при этом облегчится генерация сообщений об ошибках

DATA Root
	| Root def : Definition

-- атрибутный интерфейс компилятора: компилятор получает "библиотеку" - набор типов
-- библиотечных символов. Возвращается программа на Си++ в виде АТД, определенного в
-- CPP.Intermediate, которая потом преобразуется в текст с помощью CPP.Visualise

ATTR Root
	[
		library : {M.Map String T}
	|
	|
		cppDefinition : CppDefinition
	]

SEM Root
	| Root
		def.level = 0
		def.inhCounter = 0
		def.visibleAtoms = @lhs.library
		def.inferredTypes = @lhs.library
		def.qualifiers = M.map (const $ CppFqMethod "ff") @lhs.library
		def.finalSubstitution = xtrace "Root.finalSubstitution" @def.s
		def.parent = "OH,PARENT (ASSERTION)"
